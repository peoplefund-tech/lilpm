# ğŸ” ì¸ì¦

> ì•ˆì „í•œ ì‚¬ìš©ì ì¸ì¦ ë° íŒ€ ì ‘ê·¼ ê´€ë¦¬

## ê°œìš”

LilPMì€ Supabase Authë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ì„ ì œê³µí•©ë‹ˆë‹¤. íšŒì›ê°€ì… í›„ ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.

## ì¸ì¦ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   íšŒì›ê°€ì…   â”‚ â”€â”€â†’ â”‚ ì´ë©”ì¼ ì¸ì¦  â”‚ â”€â”€â†’ â”‚   /welcome  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                    â”‚
                          â–¼                    â–¼
                    ì¸ì¦ ë§í¬ í´ë¦­        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚              â”‚ ì˜¨ë³´ë”© ì„ íƒ    â”‚
                          â”‚              â”‚ â€¢ íŒ€ ìƒì„±      â”‚
                          â”‚              â”‚ â€¢ AI ì„¤ì •      â”‚
                          â”‚              â”‚ â€¢ LLM ì„¤ì •     â”‚
                          â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ë¡œê·¸ì¸    â”‚ â†â”€â”€ â”‚         í™ˆ ëŒ€ì‹œë³´ë“œ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ë¦¬ë””ë ‰ì…˜ ë¡œì§ (App.tsx lines 102-109)

```tsx
// ì´ë©”ì¼ ë¯¸ì¸ì¦ + íŒ€ ì—†ìŒ â†’ ì´ë©”ì¼ ì¸ì¦ í˜ì´ì§€
if (!isEmailVerified && teams.length === 0) {
  return <Navigate to="/auth/verify-email" replace />;
}

// íŒ€ ì—†ìŒ + ì˜¨ë³´ë”© ë¯¸ì™„ë£Œ â†’ /welcome í˜ì´ì§€
if (teams.length === 0 && !onboardingCompleted) {
  return <Navigate to="/welcome" replace />;
}
```

**ì¤‘ìš”:** íŒ€ì´ ì—†ëŠ” ì‹ ê·œ ìœ ì €ëŠ” `/onboarding/create-team`ì´ ì•„ë‹Œ **`/welcome`** í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ë©ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

### 1. ì´ë©”ì¼ ì¸ì¦

íšŒì›ê°€ì… í›„ ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤:

```typescript
// authStore.ts
signup: async (email, password, name) => {
  const { data, error } = await supabase.auth.signUp({
    email,
    password,
    options: {
      emailRedirectTo: `${siteUrl}/welcome`,
      data: { name },
    },
  });
  
  // ì¸ì¦ ëŒ€ê¸° í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  navigate('/auth/verify-email');
}
```

### 2. ì¸ì¦ ìƒíƒœ ê´€ë¦¬

```typescript
interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  isEmailVerified: boolean;
  isLoading: boolean;
}
```

### 3. ë¼ìš°íŠ¸ ë³´í˜¸

```tsx
// App.tsx
<Route element={<ProtectedRoute />}>
  <Route element={<OnboardingCheck />}>
    <Route path="/" element={<HomePage />} />
  </Route>
</Route>

// ProtectedRoute - ë¡œê·¸ì¸ í•„ìˆ˜
// OnboardingCheck - ì´ë©”ì¼ ì¸ì¦ + íŒ€ ì¡´ì¬ í™•ì¸
```

## í˜ì´ì§€ êµ¬ì„±

### íšŒì›ê°€ì… (`/signup`)
- ì´ë¦„, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
- ê°€ì… í›„ `/auth/verify-email`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

### ì´ë©”ì¼ ì¸ì¦ ëŒ€ê¸° (`/auth/verify-email`)
- ì¸ì¦ ì´ë©”ì¼ ë°œì†¡ ì•ˆë‚´
- "ì¸ì¦ ì´ë©”ì¼ ì¬ë°œì†¡" ë²„íŠ¼
- ì¸ì¦ ì™„ë£Œ ì‹œ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸

### Welcome í˜ì´ì§€ (`/welcome`)
ì‹ ê·œ ìœ ì €ì˜ ê¸°ë³¸ ëœë”© í˜ì´ì§€:
- íŒ€ ìƒì„± ì˜µì…˜
- AI ì„¤ì • ì˜µì…˜
- íŠœí† ë¦¬ì–¼ ë§í¬

### ë¡œê·¸ì¸ (`/login`)
- ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
- ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” `/auth/verify-email`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- íŒ€ ì—†ìœ¼ë©´ `/welcome`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

### ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • (`/password-reset`)
- ì´ë©”ì¼ ì…ë ¥ìœ¼ë¡œ ì¬ì„¤ì • ë§í¬ ë°œì†¡

## ì´ˆëŒ€ ìˆ˜ë½ í˜ì´ì§€ (`/invite/accept`)

íŒ€ ì´ˆëŒ€ ë§í¬ë¥¼ í†µí•´ ê°€ì…í•œ ìœ ì €ì˜ í”Œë¡œìš°:

```
ì´ˆëŒ€ ë§í¬ í´ë¦­ â†’ ì´ˆëŒ€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ â†’ [ìˆ˜ë½] / [ê±°ì ˆ]
                      â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  ì¸ì¦ ìƒíƒœ?      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ì¸ì¦ë¨ â†™         â†“           â†˜ ë¯¸ì¸ì¦
  ìˆ˜ë½ ì²˜ë¦¬    ë¡œê·¸ì¸ìœ¼ë¡œ ë¦¬ë””ë ‰íŠ¸   ë¡œê·¸ì¸/ê°€ì… UI
      â†“         (returnUrl í¬í•¨)        â†“
   íŒ€ í•©ë¥˜           â†“             íšŒì›ê°€ì…
      â†“          ë¡œê·¸ì¸ í›„              â†“
   í™ˆ ì´ë™       ì´ˆëŒ€ í˜ì´ì§€ ë³µê·€     ì´ë©”ì¼ ì¸ì¦
                    â†“                  â†“
                 ìˆ˜ë½ ì²˜ë¦¬         /auth/verify-email
```

### ì¸ì¦ ì²´í¬ (ì¤‘ìš”!)

`acceptInvite` í˜¸ì¶œ ì‹œ ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ìœ¼ë¡œ ë¦¬ë””ë ‰íŠ¸:

```tsx
// AcceptInvitePage.tsx (lines 98-109)
if (!isAuthenticated) {
  const returnUrl = `/invite/accept?token=${token}`;
  navigate(`/login?returnUrl=${encodeURIComponent(returnUrl)}`);
  return;
}
```

### ì´ë©”ì¼ ì¸ì¦ ê²½ë¡œ

ì‹ ê·œ ê°€ì… ì‹œ ì´ë©”ì¼ ì¸ì¦ í˜ì´ì§€ ê²½ë¡œ:
- âœ… ì˜¬ë°”ë¥¸ ê²½ë¡œ: `/auth/verify-email`
- âŒ ì˜ëª»ëœ ê²½ë¡œ: `/verify-email` (404 ë°œìƒ)

**ì¤‘ìš”:** ì´ˆëŒ€ ìˆ˜ë½ í›„ì—ëŠ” ì˜¨ë³´ë”© ë‹¨ê³„(íŒ€ ìƒì„±, LLM ì„¤ì • ë“±)ë¥¼ **ê±´ë„ˆë›°ê³ ** ë°”ë¡œ í™ˆìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.

## ì˜¨ë³´ë”© í”Œë¡œìš°

ì¸ì¦ ì™„ë£Œ í›„ `/welcome`ì—ì„œ ì‹œì‘:

1. **íŒ€ ìƒì„±** (`/onboarding/create-team`)
   - íŒ€ ì´ë¦„ ì…ë ¥
   - íŒ€ URL slug ì„¤ì •
   - ìƒì„±ìê°€ ìë™ìœ¼ë¡œ **Owner** ì—­í•  ë¶€ì—¬

2. **AI ì„¤ì •** (`/onboarding/ai-setup`)
   - AI API í‚¤ ì…ë ¥ (ì„ íƒ)
   - ê¸°ë³¸ AI ëª¨ë¸ ì„ íƒ

## ê¶Œí•œ ê´€ë¦¬

### íŒ€ ì—­í• 

| ì—­í•  | ê¶Œí•œ |
|------|------|
| **Owner** | ëª¨ë“  ê¶Œí•œ, íŒ€ ì‚­ì œ |
| **Admin** | ë©¤ë²„ ê´€ë¦¬, ì„¤ì • ë³€ê²½ |
| **Member** | ì´ìŠˆ/PRD ìƒì„± ë° í¸ì§‘ |
| **Guest** | ì½ê¸° ì „ìš© |

### íŒ€ ì´ˆëŒ€ (Edge Functions)

| í•¨ìˆ˜ëª… | ìš©ë„ |
|--------|------|
| `accept-invite-v2` | ì´ˆëŒ€ ìˆ˜ë½ (ì¸ì¦/ë§¤ì§ë§í¬/íšŒì›ê°€ì…) - `_shared/` ëª¨ë“ˆ ì‚¬ìš© |
| `get-invite-preview` | ë¹„ì¸ì¦ ìœ ì €ì˜ ì´ˆëŒ€ ë¯¸ë¦¬ë³´ê¸° (Service Role) |
| `send-team-invite` | íŒ€ ì´ˆëŒ€ ì´ë©”ì¼ ë°œì†¡ (`_shared/email.ts` ì‚¬ìš©) |

> ëª¨ë“  Edge FunctionsëŠ” `_shared/` ê³µìœ  ëª¨ë“ˆ(CORS, env, email, response, supabase)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- âœ… ë¹„ë°€ë²ˆí˜¸ëŠ” Supabaseì—ì„œ bcrypt í•´ì‹±
- âœ… JWT í† í° ê¸°ë°˜ ì„¸ì…˜ ê´€ë¦¬
- âœ… ì´ë©”ì¼ ì¸ì¦ í•„ìˆ˜
- âœ… API í‚¤ëŠ” ì„œë²„ ì‚¬ì´ë“œ ì•”í˜¸í™” ì €ì¥
- âœ… Row Level Security (RLS) ì ìš©
- âœ… Service Roleë¡œë§Œ ì´ˆëŒ€ ë¯¸ë¦¬ë³´ê¸° ì ‘ê·¼

---

**ê´€ë ¨ ë¬¸ì„œ**
- [íŒ€ ë©¤ë²„ ê´€ë¦¬](./team-members.md)
- [í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…ì²˜](../architecture/frontend.md)
- [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](../architecture/database.md)
